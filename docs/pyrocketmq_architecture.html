<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>pyrocketmq ç³»ç»Ÿæ¶æ„å›¾</title>
        <style>
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .container {
                max-width: 1400px;
                width: 100%;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
                padding: 30px;
                margin-bottom: 30px;
            }

            h1 {
                text-align: center;
                color: #2c3e50;
                margin-bottom: 10px;
                font-size: 2.5em;
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            }

            .subtitle {
                text-align: center;
                color: #7f8c8d;
                margin-bottom: 30px;
                font-size: 1.2em;
            }

            .legend {
                display: flex;
                justify-content: center;
                flex-wrap: wrap;
                gap: 20px;
                margin-bottom: 30px;
                padding: 15px;
                background: #f8f9fa;
                border-radius: 10px;
                border: 1px solid #e9ecef;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 5px 10px;
                background: white;
                border-radius: 5px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }

            .legend-box {
                width: 20px;
                height: 20px;
                border-radius: 4px;
                border: 2px solid #333;
            }

            .architecture-diagram {
                position: relative;
                width: 100%;
                height: 900px;
                background: #ffffff;
                border-radius: 10px;
                border: 2px solid #3498db;
                overflow: hidden;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .layer {
                position: absolute;
                width: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 10px 0;
                border-bottom: 1px solid #ecf0f1;
            }

            .layer-title {
                position: absolute;
                left: 20px;
                background: #2c3e50;
                color: white;
                padding: 8px 15px;
                border-radius: 20px;
                font-weight: bold;
                font-size: 0.9em;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                z-index: 10;
            }

            /* å±‚çº§æ ·å¼ */
            .app-layer {
                top: 0;
                height: 120px;
                background: linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%);
            }
            .client-layer {
                top: 120px;
                height: 140px;
                background: linear-gradient(135deg, #e3f2fd 0%, #f0f4f8 100%);
            }
            .discovery-layer {
                top: 260px;
                height: 120px;
                background: linear-gradient(135deg, #fff3e0 0%, #fff8f0 100%);
            }
            .communication-layer {
                top: 380px;
                height: 140px;
                background: linear-gradient(135deg, #fce4ec 0%, #fef7f7 100%);
            }
            .transport-layer {
                top: 520px;
                height: 120px;
                background: linear-gradient(135deg, #f3e5f5 0%, #faf5ff 100%);
            }
            .model-layer {
                top: 640px;
                height: 120px;
                background: linear-gradient(135deg, #e1f5fe 0%, #f7fbff 100%);
            }
            .utils-layer {
                top: 760px;
                height: 140px;
                background: linear-gradient(135deg, #f1f8e9 0%, #f8fff7 100%);
            }

            /* ç»„ä»¶æ ·å¼ */
            .component {
                display: inline-flex;
                flex-direction: column;
                align-items: center;
                margin: 0 15px;
                padding: 10px 15px;
                border-radius: 8px;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                min-width: 100px;
                text-align: center;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }

            .component:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            }

            .component-icon {
                font-size: 24px;
                margin-bottom: 5px;
            }

            .component-name {
                font-size: 12px;
                font-weight: bold;
                color: #2c3e50;
                margin-bottom: 2px;
            }

            .component-desc {
                font-size: 10px;
                color: #7f8c8d;
                max-width: 120px;
            }

            /* ç»„ä»¶ç±»å‹æ ·å¼ */
            .client-instance {
                background: linear-gradient(135deg, #3498db, #2980b9);
                color: white !important;
            }

            .client-instance .component-name,
            .client-instance .component-desc {
                color: white !important;
            }

            .message-processor {
                background: linear-gradient(135deg, #e74c3c, #c0392b);
                color: white !important;
            }

            .message-processor .component-name,
            .message-processor .component-desc {
                color: white !important;
            }

            .thread-pool {
                background: linear-gradient(135deg, #f39c12, #e67e22);
                color: white !important;
            }

            .thread-pool .component-name,
            .thread-pool .component-desc {
                color: white !important;
            }

            .callback-logic {
                background: linear-gradient(135deg, #9b59b6, #8e44ad);
                color: white !important;
            }

            .callback-logic .component-name,
            .callback-logic .component-desc {
                color: white !important;
            }

            .config-management {
                background: linear-gradient(135deg, #1abc9c, #16a085);
                color: white !important;
            }

            .config-management .component-name,
            .config-management .component-desc {
                color: white !important;
            }

            .connection-pool {
                background: linear-gradient(135deg, #34495e, #2c3e50);
                color: white !important;
            }

            .connection-pool .component-name,
            .connection-pool .component-desc {
                color: white !important;
            }

            .protocol-handling {
                background: linear-gradient(135deg, #27ae60, #229954);
                color: white !important;
            }

            .protocol-handling .component-name,
            .protocol-handling .component-desc {
                color: white !important;
            }

            /* è¿æ¥çº¿ */
            .connection {
                position: absolute;
                background: #3498db;
                opacity: 0.6;
                z-index: 1;
            }

            .vertical-line {
                width: 2px;
            }

            .horizontal-line {
                height: 2px;
            }

            /* å“åº”å¼è®¾è®¡ */
            @media (max-width: 768px) {
                .container {
                    padding: 15px;
                }

                h1 {
                    font-size: 2em;
                }

                .architecture-diagram {
                    height: 1200px;
                }

                .layer {
                    flex-wrap: wrap;
                    padding: 20px 0;
                }

                .layer-title {
                    position: static;
                    margin-bottom: 10px;
                    display: block;
                    text-align: center;
                }

                .component {
                    margin: 5px;
                    min-width: 80px;
                }

                .component-name {
                    font-size: 11px;
                }

                .component-desc {
                    font-size: 9px;
                    max-width: 80px;
                }
            }

            /* åŠ¨ç”»æ•ˆæœ */
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .component {
                animation: fadeInUp 0.5s ease forwards;
            }

            .component:nth-child(1) {
                animation-delay: 0.1s;
            }
            .component:nth-child(2) {
                animation-delay: 0.2s;
            }
            .component:nth-child(3) {
                animation-delay: 0.3s;
            }
            .component:nth-child(4) {
                animation-delay: 0.4s;
            }
            .component:nth-child(5) {
                animation-delay: 0.5s;
            }
            .component:nth-child(6) {
                animation-delay: 0.6s;
            }

            /* å·¥å…·æç¤º */
            .tooltip {
                position: absolute;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                white-space: nowrap;
                z-index: 1000;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.3s;
            }

            .tooltip.show {
                opacity: 1;
            }

            .info-panel {
                margin-top: 20px;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border-left: 5px solid #3498db;
            }

            .info-panel h3 {
                margin-top: 0;
                color: #2c3e50;
            }

            .info-panel ul {
                margin: 10px 0;
                padding-left: 20px;
            }

            .info-panel li {
                margin: 5px 0;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸš€ pyrocketmq ç³»ç»Ÿæ¶æ„å›¾</h1>
            <div class="subtitle">
                åŠŸèƒ½å®Œæ•´çš„ Python RocketMQ å®¢æˆ·ç«¯åº“æ¶æ„è®¾è®¡
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-box client-instance"></div>
                    <span>å®¢æˆ·ç«¯å®ä¾‹</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box message-processor"></div>
                    <span>æ¶ˆæ¯å¤„ç†å™¨</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box thread-pool"></div>
                    <span>çº¿ç¨‹æ± </span>
                </div>
                <div class="legend-item">
                    <div class="legend-box callback-logic"></div>
                    <span>å›è°ƒé€»è¾‘</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box config-management"></div>
                    <span>é…ç½®ç®¡ç†</span>
                </div>
                <div class="legend-item">
                    <div class="legend-box connection-pool"></div>
                    <span>è¿æ¥æ± </span>
                </div>
                <div class="legend-item">
                    <div class="legend-box protocol-handling"></div>
                    <span>åè®®å¤„ç†</span>
                </div>
            </div>

            <div class="architecture-diagram">
                <!-- åº”ç”¨å±‚ -->
                <div class="layer app-layer">
                    <div class="layer-title">åº”ç”¨å±‚ (Application)</div>
                    <div class="component client-instance">
                        <div class="component-icon">ğŸ“¦</div>
                        <div class="component-name">Producer</div>
                        <div class="component-desc">æ¶ˆæ¯ç”Ÿäº§è€…</div>
                    </div>
                    <div class="component client-instance">
                        <div class="component-icon">ğŸ“¥</div>
                        <div class="component-name">Consumer</div>
                        <div class="component-desc">æ¶ˆæ¯æ¶ˆè´¹è€…</div>
                    </div>
                    <div class="component client-instance">
                        <div class="component-icon">ğŸ”„</div>
                        <div class="component-name">TransactionProducer</div>
                        <div class="component-desc">äº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…</div>
                    </div>
                </div>

                <!-- å®¢æˆ·ç«¯å±‚ -->
                <div class="layer client-layer">
                    <div class="layer-title">å®¢æˆ·ç«¯å±‚ (Client)</div>
                    <div class="component message-processor">
                        <div class="component-icon">ğŸ¯</div>
                        <div class="component-name">MessageRouter</div>
                        <div class="component-desc">æ™ºèƒ½è·¯ç”±é€‰æ‹©</div>
                    </div>
                    <div class="component callback-logic">
                        <div class="component-icon">ğŸ‘‚</div>
                        <div class="component-name">MessageListener</div>
                        <div class="component-desc">æ¶ˆæ¯ç›‘å¬å™¨</div>
                    </div>
                    <div class="component message-processor">
                        <div class="component-icon">ğŸ“Š</div>
                        <div class="component-name">SubscriptionManager</div>
                        <div class="component-desc">è®¢é˜…ç®¡ç†å™¨</div>
                    </div>
                    <div class="component config-management">
                        <div class="component-icon">âš™ï¸</div>
                        <div class="component-name">ProducerConfig</div>
                        <div class="component-desc">ç”Ÿäº§è€…é…ç½®</div>
                    </div>
                    <div class="component config-management">
                        <div class="component-icon">âš™ï¸</div>
                        <div class="component-name">ConsumerConfig</div>
                        <div class="component-desc">æ¶ˆè´¹è€…é…ç½®</div>
                    </div>
                </div>

                <!-- æ³¨å†Œå‘ç°å±‚ -->
                <div class="layer discovery-layer">
                    <div class="layer-title">æ³¨å†Œå‘ç°å±‚ (Discovery)</div>
                    <div class="component connection-pool">
                        <div class="component-icon">ğŸ—ºï¸</div>
                        <div class="component-name">NameServerClient</div>
                        <div class="component-desc">è·¯ç”±å‘ç°å®¢æˆ·ç«¯</div>
                    </div>
                    <div class="component callback-logic">
                        <div class="component-icon">ğŸ’¾</div>
                        <div class="component-name">TopicBrokerMapping</div>
                        <div class="component-desc">ä¸»é¢˜-ä»£ç†æ˜ å°„</div>
                    </div>
                    <div class="component thread-pool">
                        <div class="component-icon">âš–ï¸</div>
                        <div class="component-name">
                            AverageAllocateStrategy
                        </div>
                        <div class="component-desc">é˜Ÿåˆ—åˆ†é…ç­–ç•¥</div>
                    </div>
                </div>

                <!-- è¿œç¨‹é€šä¿¡å±‚ -->
                <div class="layer communication-layer">
                    <div class="layer-title">è¿œç¨‹é€šä¿¡å±‚ (Remote)</div>
                    <div class="component connection-pool">
                        <div class="component-icon">ğŸŒ</div>
                        <div class="component-name">Remote</div>
                        <div class="component-desc">åŒæ­¥è¿œç¨‹é€šä¿¡</div>
                    </div>
                    <div class="component connection-pool">
                        <div class="component-icon">ğŸŒ</div>
                        <div class="component-name">AsyncRemote</div>
                        <div class="component-desc">å¼‚æ­¥è¿œç¨‹é€šä¿¡</div>
                    </div>
                    <div class="component connection-pool">
                        <div class="component-icon">ğŸ”—</div>
                        <div class="component-name">ConnectionPool</div>
                        <div class="component-desc">è¿æ¥æ± ç®¡ç†</div>
                    </div>
                    <div class="component protocol-handling">
                        <div class="component-icon">ğŸ“¡</div>
                        <div class="component-name">BrokerClient</div>
                        <div class="component-desc">Brokeré€šä¿¡å®¢æˆ·ç«¯</div>
                    </div>
                </div>

                <!-- ä¼ è¾“å±‚ -->
                <div class="layer transport-layer">
                    <div class="layer-title">ä¼ è¾“å±‚ (Transport)</div>
                    <div class="component protocol-handling">
                        <div class="component-icon">ğŸ”Œ</div>
                        <div class="component-name">ConnectionStateMachine</div>
                        <div class="component-desc">è¿æ¥çŠ¶æ€æœº</div>
                    </div>
                    <div class="component protocol-handling">
                        <div class="component-icon">ğŸ”Œ</div>
                        <div class="component-name">
                            AsyncConnectionStateMachine
                        </div>
                        <div class="component-desc">å¼‚æ­¥è¿æ¥çŠ¶æ€æœº</div>
                    </div>
                    <div class="component config-management">
                        <div class="component-icon">ğŸ› ï¸</div>
                        <div class="component-name">TransportConfig</div>
                        <div class="component-desc">ä¼ è¾“é…ç½®</div>
                    </div>
                </div>

                <!-- åè®®æ¨¡å‹å±‚ -->
                <div class="layer model-layer">
                    <div class="layer-title">åè®®æ¨¡å‹å±‚ (Model)</div>
                    <div class="component protocol-handling">
                        <div class="component-icon">ğŸ“‹</div>
                        <div class="component-name">RemotingCommand</div>
                        <div class="component-desc">è¿œç¨‹å‘½ä»¤åè®®</div>
                    </div>
                    <div class="component message-processor">
                        <div class="component-icon">ğŸ“¨</div>
                        <div class="component-name">Message</div>
                        <div class="component-desc">æ¶ˆæ¯æ•°æ®ç»“æ„</div>
                    </div>
                    <div class="component protocol-handling">
                        <div class="component-icon">ğŸ”§</div>
                        <div class="component-name">Serializer</div>
                        <div class="component-desc">åè®®åºåˆ—åŒ–å™¨</div>
                    </div>
                </div>

                <!-- å·¥å…·æ”¯æŒå±‚ -->
                <div class="layer utils-layer">
                    <div class="layer-title">å·¥å…·æ”¯æŒå±‚ (Utils & Logging)</div>
                    <div class="component thread-pool">
                        <div class="component-icon">ğŸ”’</div>
                        <div class="component-name">SyncRWLock</div>
                        <div class="component-desc">è¯»å†™é”</div>
                    </div>
                    <div class="component callback-logic">
                        <div class="component-icon">ğŸ“</div>
                        <div class="component-name">Logging</div>
                        <div class="component-desc">æ—¥å¿—ç³»ç»Ÿ</div>
                    </div>
                    <div class="component callback-logic">
                        <div class="component-icon">ï¿½ï¿½</div>
                        <div class="component-name">OffsetStore</div>
                        <div class="component-desc">åç§»é‡å­˜å‚¨</div>
                    </div>
                    <div class="component message-processor">
                        <div class="component-icon">ğŸ“‹</div>
                        <div class="component-name">ProcessQueue</div>
                        <div class="component-desc">æ¶ˆæ¯ç¼“å­˜é˜Ÿåˆ—</div>
                    </div>
                </div>
            </div>

            <div class="info-panel">
                <h3>ğŸ“‹ æ¶æ„è¯´æ˜</h3>
                <ul>
                    <li>
                        <strong>åˆ†å±‚æ¶æ„è®¾è®¡</strong
                        >ï¼šé‡‡ç”¨æ¸…æ™°çš„7å±‚æ¶æ„ï¼Œæ¯å±‚èŒè´£æ˜ç¡®ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
                    </li>
                    <li>
                        <strong>åŒæ¨¡å¼æ”¯æŒ</strong
                        >ï¼šæ¯ä¸€å±‚éƒ½æä¾›åŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§å®ç°ï¼Œæ»¡è¶³ä¸åŒæ€§èƒ½éœ€æ±‚åœºæ™¯
                    </li>
                    <li>
                        <strong>æ™ºèƒ½è·¯ç”±</strong
                        >ï¼šæ”¯æŒè½®è¯¢ã€éšæœºã€æ¶ˆæ¯å“ˆå¸Œç­‰å¤šç§è·¯ç”±ç­–ç•¥ï¼Œå…·å¤‡æ•…éšœæ„ŸçŸ¥èƒ½åŠ›
                    </li>
                    <li>
                        <strong>äº‹åŠ¡æ¶ˆæ¯</strong
                        >ï¼šå®Œæ•´å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æ¶ˆæ¯ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
                    </li>
                    <li>
                        <strong>è¿æ¥ç®¡ç†</strong
                        >ï¼šå†…ç½®è¿æ¥æ± ï¼Œæ”¯æŒè¿æ¥å¤ç”¨å’Œå¥åº·æ£€æŸ¥
                    </li>
                    <li>
                        <strong>åè®®å…¼å®¹</strong>ï¼šä¸¥æ ¼éµå¾ª RocketMQ TCP
                        åè®®ï¼Œä¸å®˜æ–¹å®ç°å®Œå…¨å…¼å®¹
                    </li>
                    <li>
                        <strong>é…ç½®ç®¡ç†</strong
                        >ï¼šæä¾›çµæ´»çš„é…ç½®ç³»ç»Ÿï¼Œæ”¯æŒç¯å¢ƒå˜é‡å’Œé¢„è®¾æ¨¡æ¿
                    </li>
                </ul>
            </div>
        </div>

        <div class="tooltip" id="tooltip"></div>

        <script>
            // æ·»åŠ å·¥å…·æç¤ºåŠŸèƒ½
            const components = document.querySelectorAll(".component");
            const tooltip = document.getElementById("tooltip");

            components.forEach((component) => {
                component.addEventListener("mouseenter", (e) => {
                    const rect = e.target.getBoundingClientRect();
                    const name =
                        e.target.querySelector(".component-name").textContent;
                    const desc =
                        e.target.querySelector(".component-desc").textContent;

                    tooltip.innerHTML = `<strong>${name}</strong><br>${desc}`;
                    tooltip.style.left = rect.left + "px";
                    tooltip.style.top = rect.top - 60 + "px";
                    tooltip.classList.add("show");
                });

                component.addEventListener("mouseleave", () => {
                    tooltip.classList.remove("show");
                });
            });

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
            components.forEach((component) => {
                component.addEventListener("click", (e) => {
                    const name =
                        e.target.querySelector(".component-name").textContent;
                    console.log(`ç‚¹å‡»äº†ç»„ä»¶: ${name}`);
                });
            });
        </script>
    </body>
</html>
